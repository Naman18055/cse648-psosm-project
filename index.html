<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Whack A Mole!</title>
    <link href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Whatsapp-A-Mole! <span class="score">0</span></h1>
<button onClick="startGame()">Start!</button>

<section class="container">

    <div class="options">
        <div class="ques">
            <p id = "q"></p>
        </div>
        <div class="op" id = "op1">
            <p style = 'background: url("assets/img/TextBox_Blue.png") no-repeat; background-size: 380px 60px; margin-top: 10px;', class="op-img"></p>
        </div>
        <div class="op" id = "op2">
            <p style = 'background: url("assets/img/TextBox_Green.png") no-repeat; background-size: 380px 60px; margin-top: 0px;', class="op-img"></p>
        </div>
        <div class="op" id = "op3">
            <p style = 'background: url("assets/img/TextBox_Pink.png") no-repeat; background-size: 380px 60px; margin-top: 0px;', class="op-img"></p>
        </div>
        <div class="op" id = "op4">
            <p style = 'background: url("assets/img/TextBox_Yellow.png") no-repeat; background-size: 380px 60px; margin-top: 0px;', class="op-img"></p>
        </div>
    </div>

    <div class="game">
        <div class="hole hole1">
            <div class="mole mole1"></div>
        </div>
        <div class="hole hole2">
            <div class="mole mole2"></div>
        </div>
        <div class="hole hole3">
            <div class="mole mole3"></div>
        </div>
        <div class="hole hole4">
            <div class="mole mole4"></div>
        </div>
        <div class="hole hole5">
            <div class="mole mole1"></div>
        </div>
        <div class="hole hole6">
            <div class="mole mole2"></div>
        </div>
        <div class="hole hole7">
            <div class="mole mole3"></div>
        </div>
        <div class="hole hole8">
            <div class="mole mole4"></div>
        </div>
        <div class="hole hole9">
            <div class="mole mole1"></div>
        </div>
    </div>
</section>



<script>
    const holes = document.querySelectorAll(".hole");
    const scoreBoard = document.querySelector(".score");
    const questionbox = document.querySelector("#q");
    const moles = document.querySelectorAll(".mole");
    const choicebox = document.querySelectorAll(".op-img");
    let lastHole;
    let timeUp = false;
    let score = 0;
    var prev = [];
    var iter = 0;
    var correct_answer_color = "";
    const color = ["blue", "green", "pink", "yellow"];
    const questions = ["Which of the following can you not change on whatsapp?","Whatsapp is a part of which companies?"];
    const choices = [["Age","Phone number","Name","Profile Picture"],["Facebook","Google", "Microsoft","Oracle"]];

    function randomTime(min, max) {
        // Let's create the random amount of time the mole shows up
        // return Math.round(Math.random() * (max - min) + min);
        return 1000;
    }

    function randomHole(holes) {
        var done = [];
        var idx = Math.floor(Math.random() * holes.length);
        while (prev.includes(idx)){
            idx = Math.floor(Math.random() * holes.length);
        }
        const hole1 = holes[idx];
        done.push(idx);
        return [hole1];
        // idx = Math.floor(Math.random() * holes.length);
        // while (done.includes((idx)) || prev.includes(idx)){
        //     idx = Math.floor(Math.random() * holes.length);
        // }
        // const hole2 = holes[idx];
        // done.push(idx);
        // idx = Math.floor(Math.random() * holes.length);
        // while (done.includes((idx)) || prev.includes(idx)){
        //     idx = Math.floor(Math.random() * holes.length);
        // }
        // const hole3 = holes[idx];
        // done.push(idx);
        // idx = Math.floor(Math.random() * holes.length);
        // while (done.includes((idx)) || prev.includes(idx)){
        //     idx = Math.floor(Math.random() * holes.length);
        // }
        // const hole4 = holes[idx];
        // done.push(idx);
        // prev = done;
        // return [hole1, hole2, hole3, hole4];
    }

    function up(h){
        h.classList.add("up");
    }

    function down(h){
        h.classList.remove("up");
    }

    function peep() {
        const time = randomTime(200, 1000);
        const hole = randomHole(holes);

        hole.forEach(up);

        setTimeout(() => {
            if (!timeUp) peep();
            hole.forEach(down);
        }, time); //after the time is up we want the moles to disappear and remove the class
    }

    function bunk(e) {
        console.log(this.classList);
        if (!e.isTrusted) return; // close out the fake clicks during the game
        // e.target.style.cursor = "url(\"assets/img/2915.jpg\"), auto";

        let temp1 = e.target.style.background;
        let temp2 = e.target.style.backgroundSize;

        let temp3 = this.classList[1];
        // let temp4 = this.classList[1].target.style.backgroundSize;

        console.log(temp3);

        let color_selected = "default";

        if (temp3.localeCompare("mole1") == 0){
            color_selected = 'yellow';
        }

        if (temp3.localeCompare("mole2") == 0){
            color_selected = 'pink';
        }

        if (temp3.localeCompare("mole3") == 0){
            color_selected = 'green';
        }

        if (temp3.localeCompare("mole4") == 0){
            color_selected = 'blue';
        }

        e.target.style.background = "url(\"assets/img/mole2.png\") bottom center no-repeat";
        e.target.style.backgroundSize = "40%";

        setTimeout(() => {
            e.target.style.background = temp1
            e.target.style.backgroundSize = temp2
        }, 1000)

        this.classList.remove("up");
        console.log(color_selected);
        console.log(correct_answer_color);
        if(color_selected.localeCompare(correct_answer_color)==0) {
            score++;
            scoreBoard.textContent = score;
        }
        iter++;
        newQuestion();
    }

    moles.forEach(mole => mole.addEventListener("click", bunk));

    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }

    function newQuestion(){
        let question = questions[iter];
        let choice = choices[iter];
        let correct_answer = choice[0];
        shuffle(choice);
        for(let i=0;i<4;i++){
            if(choice[i] == correct_answer){
                correct_answer_color = color[i];
                break;
            }
        }
        questionbox.textContent = question;
        for(let i=0;i<4;i++){
            choicebox[i].textContent = choice[i];
        }
    }

    function startGame() {
        newQuestion();
        scoreBoard.textContent = 0;
        score = 0;
        timeUp = false;
        peep();
        setTimeout(() => {
            timeUp = true;
        }, 60000);
    }
</script>
</body>
</html>